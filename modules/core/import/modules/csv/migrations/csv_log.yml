id: csv_log
label: farmOS Log CSV Importers
migration_group: farm_import_csv
source:
  plugin: csv_file
destination:
  plugin: entity:log
process:

  # Log name.
  name: name

  # Parse log timestamp with strtotime().
  timestamp:
    plugin: callback
    callable: strtotime
    source: timestamp

  # Create a quantity, if necessary.
  # This will also create a new unit term, if necessary.
  _qty_units:
    - plugin: skip_on_empty
      method: process
      source: quantity units
    - plugin: entity_generate
      entity_type: taxonomy_term
      value_key: name
      bundle_key: vid
      bundle: unit
      source: quantity units
  quantity:
    - plugin: concat
      method: process
      source:
        - quantity
        - quantity measure
        - quantity units
        - quantity label
    - plugin: skip_on_empty
      method: process
    - plugin: static_map
      map: {  }
      default_value: [ [ ] ]
    - plugin: create_quantity
      default_values:
        type: standard
      values:
        value: quantity
        measure: quantity measure
        units: '@_qty_units'
        label: quantity label

  # Log notes with default format.
  notes/0/value: notes
  notes/0/format:
    plugin: default_value
    default_value: default

  # Log status.
  status:
    - plugin: get
      source: status
    - plugin: default_value
      default_value: done

# Describe the base columns.
third_party_settings:
  farm_import_csv:
    columns:
      - name: name
        description: Name of the log.
      - name: timestamp
        description: Timestamp of the log. Accepts most date/time formats.
      - name: quantity
        description: Numeric quantity value. Accepts integers or decimals.
      - name: quantity measure
        description: Measure of the quantity.
      - name: quantity units
        description: Units of measurement of the quantity. A new term in the units taxonomy will be created if necessary.
      - name: quantity label
        description: Label of the quantity.
      - name: notes
        description: Notes about the log.
      - name: status
        description: 'Status of the log. Allowed values: pending, done. Defaults to done.'

deriver: \Drupal\farm_import_csv\Plugin\Derivative\CsvImportMigrationLog
