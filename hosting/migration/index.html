
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../favicon.ico">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.3.2">
    
    
      
        <title>1.x Migration - farmOS 2.x Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.24c991ad.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.3f5d1f46.min.css">
        
          
          
          <meta name="theme-color" content="#4cae4f">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="green" data-md-color-accent="orange">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#migrating-from-farmos-1x-to-2x" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="farmOS 2.x Docs" class="md-header__button md-logo" aria-label="farmOS 2.x Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 8C8 10 5.9 16.17 3.82 21.34l1.89.66.95-2.3c.48.17.98.3 1.34.3C19 20 22 3 22 3c-1 2-8 2.25-13 3.25S2 11.5 2 13.5s1.75 3.75 1.75 3.75C7 8 17 8 17 8z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            farmOS 2.x Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              1.x Migration
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="farmOS 2.x Docs" class="md-nav__button md-logo" aria-label="farmOS 2.x Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 8C8 10 5.9 16.17 3.82 21.34l1.89.66.95-2.3c.48.17.98.3 1.34.3C19 20 22 3 22 3c-1 2-8 2.25-13 3.25S2 11.5 2 13.5s1.75 3.75 1.75 3.75C7 8 17 8 17 8z"/></svg>

    </a>
    farmOS 2.x Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Data model
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Data model" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Data model
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../model/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2" type="checkbox" id="__nav_1_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_2">
          Record types
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Record types" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_2">
          <span class="md-nav__icon md-icon"></span>
          Record types
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../model/type/asset/" class="md-nav__link">
        Assets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../model/type/log/" class="md-nav__link">
        Logs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../model/type/quantity/" class="md-nav__link">
        Quantities
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../model/type/data_stream/" class="md-nav__link">
        Data streams
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../model/type/file/" class="md-nav__link">
        Files
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../model/type/term/" class="md-nav__link">
        Terms
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../model/type/plan/" class="md-nav__link">
        Plans
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../model/type/user/" class="md-nav__link">
        Users
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_3" type="checkbox" id="__nav_1_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_3">
          Logic
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Logic" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_3">
          <span class="md-nav__icon md-icon"></span>
          Logic
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../model/logic/location/" class="md-nav__link">
        Location
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../model/logic/group/" class="md-nav__link">
        Group membership
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../model/logic/inventory/" class="md-nav__link">
        Inventory
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../model/convention/" class="md-nav__link">
        Conventions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Development
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Development" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Development
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" type="checkbox" id="__nav_2_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_1">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../development/api/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../development/api/authentication/" class="md-nav__link">
        Authentication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../development/api/changes/" class="md-nav__link">
        Changes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" type="checkbox" id="__nav_2_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_2">
          Module
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Module" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Module
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../development/module/" class="md-nav__link">
        Getting started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../development/module/entities/" class="md-nav__link">
        Entities
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../development/module/fields/" class="md-nav__link">
        Fields
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../development/module/oauth/" class="md-nav__link">
        OAuth
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../development/module/roles/" class="md-nav__link">
        Roles
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../development/module/updates/" class="md-nav__link">
        Updates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../development/module/services/" class="md-nav__link">
        Services
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" type="checkbox" id="__nav_2_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_3">
          Environment
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Environment" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          Environment
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../development/environment/" class="md-nav__link">
        Getting started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../development/environment/https/" class="md-nav__link">
        HTTPS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../development/environment/update/" class="md-nav__link">
        Updating
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../development/environment/docker/" class="md-nav__link">
        Docker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../development/environment/postgresql/" class="md-nav__link">
        PostgreSQL
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../development/environment/drush/" class="md-nav__link">
        Drush
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../development/environment/composer/" class="md-nav__link">
        Composer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../development/environment/debug/" class="md-nav__link">
        Debugging
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../development/environment/tests/" class="md-nav__link">
        Automated tests
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../development/environment/code/" class="md-nav__link">
        Coding standards
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../development/environment/documentation/" class="md-nav__link">
        Documentation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Hosting
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Hosting" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Hosting
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/" class="md-nav__link">
        Installing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../update/" class="md-nav__link">
        Updating
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../email/" class="md-nav__link">
        Email
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          1.x Migration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        1.x Migration
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#important-considerations" class="md-nav__link">
    Important considerations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-the-migration" class="md-nav__link">
    Running the migration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rolling-back-migration" class="md-nav__link">
    Rolling back migration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migrating-files" class="md-nav__link">
    Migrating files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sensor-data-streams" class="md-nav__link">
    Sensor data streams
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#limitations" class="md-nav__link">
    Limitations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    Troubleshooting
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#validation" class="md-nav__link">
    Validation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reset-status" class="md-nav__link">
    Reset status
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-limit" class="md-nav__link">
    Memory limit
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#movement-logs" class="md-nav__link">
    Movement logs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quantities" class="md-nav__link">
    Quantities
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#important-considerations" class="md-nav__link">
    Important considerations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-the-migration" class="md-nav__link">
    Running the migration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rolling-back-migration" class="md-nav__link">
    Rolling back migration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migrating-files" class="md-nav__link">
    Migrating files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sensor-data-streams" class="md-nav__link">
    Sensor data streams
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#limitations" class="md-nav__link">
    Limitations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    Troubleshooting
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#validation" class="md-nav__link">
    Validation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reset-status" class="md-nav__link">
    Reset status
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-limit" class="md-nav__link">
    Memory limit
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#movement-logs" class="md-nav__link">
    Movement logs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quantities" class="md-nav__link">
    Quantities
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="migrating-from-farmos-1x-to-2x">Migrating from farmOS 1.x to 2.x<a class="headerlink" href="#migrating-from-farmos-1x-to-2x" title="Permanent link">&para;</a></h1>
<p>The upgrade path from farmOS 1.x to 2.x is performed via a database migration.
farmOS 2.x includes a <strong>farmOS Migrate</strong> module that leverage's Drupal core's
<a href="https://drupal.org/docs/drupal-apis/migrate-api">Migrate API</a> to provide
migrations for each asset type, log type, etc. These migrations are defined in
YML configuration files included with the farmOS Migrate module.</p>
<h2 id="important-considerations">Important considerations<a class="headerlink" href="#important-considerations" title="Permanent link">&para;</a></h2>
<ul>
<li>Do not migrate into a farmOS 2.x instance that already has records. This is
  to ensure that the internal auto-incrementing IDs of records are maintained.</li>
<li>Execute the migrations in the <em>exact</em> order they are shown below. It is
  especially important that all assets are migrated <em>before</em> any areas, because
  areas are converted to assets during the migration, which can cause ID
  conflicts/collisions.
  See <a href="https://www.drupal.org/project/farm/issues/3203228">Issue #3203228</a></li>
<li>Uploaded photos/files must be copied to the destination filesystem before
  migrating. See <a href="#migrating-files">Migrating files</a> below.</li>
<li>If you are using the "Farm sensor: Listener" module, see
  <a href="#sensor-data-streams">Sensor data streams</a> below</li>
<li>See <a href="#limitations">Limitations</a> below.</li>
</ul>
<h2 id="running-the-migration">Running the migration<a class="headerlink" href="#running-the-migration" title="Permanent link">&para;</a></h2>
<p>Follow the steps below to migrate your farmOS 1.x data to farmOS 2.x:</p>
<ol>
<li>Install farmOS 2.x.</li>
<li>Install the farmOS modules you intend to use at <code>/farm/settings/modules</code>
   (this will determine what data is migrated). If you have any community
   modules installed in 1.x be sure to download and install 2.x versions.</li>
<li>Add farmOS 1.x database connection info to <code>settings.php</code>:<pre><code>$databases['migrate']['default'] = [
  'database' =&gt; 'my_farmos_1x_db',
  'username' =&gt; 'my-db-username',
  'password' =&gt; 'my-db-password',
  'prefix' =&gt; '',
  'host' =&gt; 'localhost',
  'port' =&gt; '3306',
  'namespace' =&gt; 'Drupal\\Core\\Database\\Driver\\mysql',
  'driver' =&gt; 'mysql',
];
</code></pre>
</li>
</ol>
<p>It is also recommended that you increase the PHP <code>memory_limit</code> for Drush by
   adding the following to <code>settings.php</code>:</p>
<pre><code>    if (PHP_SAPI === 'cli') {
      ini_set('memory_limit', '512M');
    }
</code></pre>
<ol>
<li>Copy user-uploaded files to the new directory (see
   <a href="#migrating-files">Migrating files</a> below).</li>
<li>Install the farmOS Migrate (<code>farm_migrate</code>) module.</li>
<li>Run the farmOS 1.x Migrations via Drush:<pre><code>drush farm_migrate:migrate
</code></pre>
</li>
</ol>
<p>Alternatively, migration groups can be run individually, if you need
more control over the process. They must be run in this order:</p>
<pre><code>drush migrate:import --group=farm_migrate_config
drush migrate:import --group=farm_migrate_role
drush migrate:import --group=farm_migrate_user
drush migrate:import --group=farm_migrate_file
drush migrate:import --group=farm_migrate_taxonomy
drush migrate:import --group=farm_migrate_asset
drush migrate:import --group=farm_migrate_area
drush migrate:import --group=farm_migrate_asset_parent
drush migrate:import --group=farm_migrate_sensor_data
drush migrate:import --group=farm_migrate_quantity
drush migrate:import --group=farm_migrate_log
drush migrate:import --group=farm_migrate_plan
</code></pre>
<p>To view the status of all farmOS 1.x migrations:</p>
<pre><code>drush migrate:status --tag="farmOS 1.x"
</code></pre>
<p>After all migrations are complete, perform a thorough examination of data to
confirm that nothing is missing or incorrect. The original 1.x database will
not be touched during the migration, so if issues are discovered it can
continue to be used as the canonical farmOS database until further testing and
debugging can be performed. See <a href="#troubleshooting">Troubleshooting</a> below for
known issues.</p>
<p>Please open bug reports in the farmOS issue queue if new issues are discovered.</p>
<h2 id="rolling-back-migration">Rolling back migration<a class="headerlink" href="#rolling-back-migration" title="Permanent link">&para;</a></h2>
<p>Migrations can be rolled back with the following command:</p>
<pre><code>drush farm_migrate:rollback
</code></pre>
<p>Alternatively, migration groups can be rolled back individually. This should be
done in the following order (reverse of the order of import):</p>
<pre><code>drush migrate:import --group=farm_migrate_plan
drush migrate:import --group=farm_migrate_log
drush migrate:import --group=farm_migrate_quantity
drush migrate:import --group=farm_migrate_sensor_data
drush migrate:import --group=farm_migrate_asset_parent
drush migrate:import --group=farm_migrate_area
drush migrate:import --group=farm_migrate_asset
drush migrate:import --group=farm_migrate_taxonomy
drush migrate:import --group=farm_migrate_file
drush migrate:import --group=farm_migrate_user
drush migrate:import --group=farm_migrate_role
drush migrate:import --group=farm_migrate_config
</code></pre>
<h2 id="migrating-files">Migrating files<a class="headerlink" href="#migrating-files" title="Permanent link">&para;</a></h2>
<p>farmOS allows files to be uploaded/attached to records. In order to migrate
these files, they need to be copied into new site's files/private directories.</p>
<p>The farmOS migration code will look for files in the following locations:</p>
<ul>
<li>Public files: <code>public://migrate</code></li>
<li>Private files: <code>private://migrate</code></li>
</ul>
<p>The <code>public://</code> and <code>private://</code> prefixes map to the "Public file system path"
and "Private file system path" configured in farmOS 1.x and 2.x at:
<code>/admin/config/media/file-system</code>. This may vary for each installation.</p>
<p>For example, if you have farmOS 1.x installed in <code>/var/www/farmOS_1.x</code> and
farmOS 2.x in <code>/var/www/farmOS_2.x</code>, and both are configured to use
<code>sites/default/files</code> for public files, and <code>sites/default/private</code> for private
files, then copy the files as follows:</p>
<pre><code>cp -rp /var/www/farmOS_1.x/sites/default/files /var/www/farmOS_2.x/sites/default/files/migrate

cp -rp /var/www/farmOS_1.x/sites/default/private/files /var/www/farmOS_2.x/sites/default/private/files/migrate
</code></pre>
<p>The farmOS migration code will automatically move files from <code>files/migrate/*</code>
to <code>files/*</code>. Only the files that it finds in the <code>{file_managed}</code> table will
be moved, leaving behind various temporary files in the <code>migrate</code> directory
that are no longer needed after the migration. This <code>migrate</code> directory can be
deleted after the migration, once it has been confirmed that everything was
migrated successfully.</p>
<h2 id="sensor-data-streams">Sensor data streams<a class="headerlink" href="#sensor-data-streams" title="Permanent link">&para;</a></h2>
<p>If you are using the "Farm sensor: Listener" module in farmOS 1.x to collect
data from sensors, there are a few extra steps and considerations for migrating
and maintaining these data streams in farmOS 2.x.</p>
<p>farmOS 2.x introduces a new entity type called "Data streams", which represent
named sets of time-series data. All data from the old "listener" module can be
migrated into named data streams.</p>
<p>In order to migrate data, you must enable the "Sensor listener (legacy)" module
in farmOS 2.x. This can be found in Drupal core's <code>/admin/modules</code> page, or it
can be enabled via Drush:</p>
<pre><code>drush en farm_sensor_listener
</code></pre>
<p>Enabling this module does two things:</p>
<ol>
<li>Adds a migration for 1.x sensor data into 2.x data streams.</li>
<li>Creates URL endpoints that match the legacy listener paths, which ensures
   that farmOS will continue receiving and storing data being pushed from your
   sensors.</li>
</ol>
<p>If you have active sensors that are sending data to your farmOS, and you want
to minimize downtime/interruption of these streams during migration, one
approach is to set up your 2.x instance on a different domain, run migrations,
and then point your domain to the new server. Be sure to set the TTL value of
your domain's DNS record to 5 minutes or less to ensure that the change
propagates quickly. It is highly recommended that you test the migrations at
least once before this, to ensure that they all work smoothly.</p>
<p>If you do not have any active sensors sending data, then you can optionally
uninstall the <code>farm_sensor_listener</code> module after running migrations. This will
remove the legacy API endpoints, but still keep your migrated data.</p>
<h2 id="limitations">Limitations<a class="headerlink" href="#limitations" title="Permanent link">&para;</a></h2>
<p>The farmOS migration code is designed to migrate a <em>default</em> farmOS 1.x
database to 2.x. If any customizations have been made on top of the defaults,
they will not be migrated.</p>
<p>This includes (but is not limited to):</p>
<ul>
<li>Custom asset, entity, taxonomies, and log types</li>
<li>Custom fields</li>
<li>Custom roles</li>
</ul>
<p>If you maintain a contrib/custom module for farmOS 1.x, it is your
responsibility to update the modules for 2.x and provide migration logic.</p>
<h2 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">&para;</a></h2>
<h3 id="validation">Validation<a class="headerlink" href="#validation" title="Permanent link">&para;</a></h3>
<p>Validation is performed on all areas, assets, logs, plans, and taxonomy terms
as they are migrated. This will check things like required fields, allowed
values, etc. In some cases the data in a 1.x database will not pass validation,
either because it was not properly validated originally, or due to legacy bugs
in the farmOS 1.x code. If any entities fail validation, migration will stop
and an error like the following will be displayed:</p>
<pre><code>farm_migrate_asset_plant Migration - 1 failed.
</code></pre>
<p>You can view validation messages for individual migrations by running
<code>drush migrate:messages [migration-id]</code>, which will provide more details. For
example:</p>
<pre><code>$ drush migrate:messages farm_migrate_asset_plant
 -------------- ------------------- ------- ---------------------------------------------------------
  Source ID(s)   Destination ID(s)   Level   Message
 -------------- ------------------- ------- ---------------------------------------------------------
  432                                1       [asset: 432]: plant_type=This value should not be null.
 -------------- ------------------- ------- ---------------------------------------------------------
</code></pre>
<p>This gives you the opportunity to fix the data in your 1.x database. Then you
can rollback and re-run the migration, like so:</p>
<pre><code>drush migrate:rollback farm_migrate_asset_plant
drush migrate:import farm_migrate_asset_plant
</code></pre>
<h3 id="reset-status">Reset status<a class="headerlink" href="#reset-status" title="Permanent link">&para;</a></h3>
<p>If an error occurs during migration, the status of the broken migration may be
stuck as "Importing". In order to rerun the migration, first reset the status
and then roll back the migration. Replace <code>[migration_id]</code> with ID of the
migration that is stuck.</p>
<pre><code>drush migrate:reset-status [migration_id]
drush migrate:rollback [migration_id]
</code></pre>
<h3 id="memory-limit">Memory limit<a class="headerlink" href="#memory-limit" title="Permanent link">&para;</a></h3>
<p>If you have a large amount of data, there is a chance you may encounter run
into the PHP memory limit. You will see an error like the following:</p>
<pre><code>Fatal error: Allowed memory size of 268435456 bytes exhausted
</code></pre>
<p>If this happens, you can increase the PHP <code>memory_limit</code> setting for Drush by
tweaking the <code>ini_set('memory_limit', '512M');</code> line in your <code>settings.php</code>,
assuming your host's memory can accommodate it.</p>
<p><strong>Be sure to roll back any migrations that were being processed when the error
occurred to ensure that no data is corrupted.</strong></p>
<h3 id="movement-logs">Movement logs<a class="headerlink" href="#movement-logs" title="Permanent link">&para;</a></h3>
<p>farmOS 2.x changes the way asset movements are described via logs. There is a
single "Location reference" and "Geometry" field on logs now, as opposed to
the separate "Move to" and "Movement geometry" fields that existed in 1.x. The
migration will use the movement area references and geometry if they are
present, and will automatically mark the log as a movement.</p>
<p>However, if the log has additional area references and geometry data, then the
migration logic will detect the conflict and one of the following errors will
be thrown:</p>
<blockquote>
<p>Log 123 has both area references and movement area references.</p>
<p>Log 123 has both a geometry and a movement geometry.</p>
</blockquote>
<p>If these errors are encountered, the migration will halt and can not be
completed until either:</p>
<ol>
<li>the logs in the old database are cleaned up, or</li>
<li>the migration script is explicitly allowed to overwrite non-movement area
   references and geometry</li>
</ol>
<p>Manual clean up involves reviewing the logs that cause errors in the old
database, deleting the "Areas" and "Geometry" fields (or copying them into the
"Move to" and "Movement geometry" fields), and retrying the migration. In some
cases it may make sense to split the log into two separate logs, in order to
retain information.</p>
<p>Alternatively, the migration script can be allowed to automatically overwrite
the "Areas" and "Geometry" data from the log, and only keep the "Move to" and
"Movement geometry" data. This can be configured by  adding the following line
to <code>settings.php</code>:</p>
<pre><code>$settings['farm_migrate_allow_movement_overwrite'] = TRUE;
</code></pre>
<p><strong>Beware that this may result in loss of data/context if the separate fields
were being used intentionally. It is recommended that logs be reviewed manually to
understand whether or not the data is needed.</strong></p>
<p>After running the migration with this setting, warnings for each log will be
stored, and can be viewed with:</p>
<pre><code>drush migrate:messages [migration_id]
</code></pre>
<h3 id="quantities">Quantities<a class="headerlink" href="#quantities" title="Permanent link">&para;</a></h3>
<p>The farmOS 2.x migration creates all Quantity entities before it creates the
Log entities that reference them. This means that it is possible to end up with
orphaned quantities, if for instance you do not migrate all of your log types
from farmOS 1.x. There is no built-in way to clean these up currently, so it is
recommended that all log types be migrated.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../email/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Email" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Email
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>. farmOS is a <a href="/community/trademark">registered trademark</a> of <a href="http://mstenta.net">Michael Stenta</a>
          </div>
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.e99e714c.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.bc35569b.min.js"></script>
      
    
  </body>
</html>